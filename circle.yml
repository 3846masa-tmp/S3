# sample circle.yml for IronMan-s3
machine:
  environment:
    docker_image: ${CIRCLE_PROJECT_REPONAME,,}  # lowercase
    docker_tag: ${CIRCLE_SHA1:0:7}
  #we package the software through docker
  services:
    - docker

checkout:
  override:
    # checkout the IronMan-ci
    - git clone git@github.com:scality/IronMan-CI.git
    # place the file gathered from IronMan-CI where needed
    - mv IronMan-CI/deployment .
    - mv IronMan-CI/ci/matryoshka*  ./tests

dependencies:
  override:
    # dependencies for testing with matryoshka
    - sudo pip install docker-py pyyaml flake8

test:
  override:
    # lint the python used for testing (node linting is done by the docker file)
    - flake8 $(git ls-files '*.py')
    # functional tests
    - bash ./tests/matryoshka-balance.sh ${docker_image} :
        parallel: true

